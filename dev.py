from web3 import Web3

# 创建合约

# geth结点
w3 = Web3(Web3.HTTPProvider('http://123.60.36.208:8545/'))

# 导入部署合约用的外部地址
account = w3.eth.account.from_key(
    "0x7bb22bc28680d0b414a7affb8ff9059291524611ab54f336f985a8ef2c5b6e77")

# 合约abi
abi =[
	{
		"inputs": [],
		"name": "addr",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "conctractBytecode",
		"outputs": [
			{
				"internalType": "bytes",
				"name": "",
				"type": "bytes"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "bytes",
				"name": "Bytecode",
				"type": "bytes"
			}
		],
		"name": "deploy",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	}
]

# 待部署合约的字节码
bytecode = "608060405234801561001057600080fd5b50610532806100206000396000f3fe608060405234801561001057600080fd5b50600436106100405760003560e01c806277436014610045578063767800de14610061578063d2f865101461007f575b600080fd5b61005f600480360381019061005a919061034d565b61009d565b005b610069610141565b60405161007691906103d7565b60405180910390f35b610087610165565b604051610094919061047a565b60405180910390f35b6000600180546100ac906104cb565b80601f01602080910402602001604051908101604052809291908181526020018280546100d8906104cb565b80156101255780601f106100fa57610100808354040283529160200191610125565b820191906000526020600020905b81548152906001019060200180831161010857829003601f168201915b5050505050905060006199998251602084016000f59050505050565b60008054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60018054610172906104cb565b80601f016020809104026020016040519081016040528092919081815260200182805461019e906104cb565b80156101eb5780601f106101c0576101008083540402835291602001916101eb565b820191906000526020600020905b8154815290600101906020018083116101ce57829003601f168201915b505050505081565b6000604051905090565b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b61025a82610211565b810181811067ffffffffffffffff8211171561027957610278610222565b5b80604052505050565b600061028c6101f3565b90506102988282610251565b919050565b600067ffffffffffffffff8211156102b8576102b7610222565b5b6102c182610211565b9050602081019050919050565b82818337600083830152505050565b60006102f06102eb8461029d565b610282565b90508281526020810184848401111561030c5761030b61020c565b5b6103178482856102ce565b509392505050565b600082601f83011261033457610333610207565b5b81356103448482602086016102dd565b91505092915050565b600060208284031215610363576103626101fd565b5b600082013567ffffffffffffffff81111561038157610380610202565b5b61038d8482850161031f565b91505092915050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006103c182610396565b9050919050565b6103d1816103b6565b82525050565b60006020820190506103ec60008301846103c8565b92915050565b600081519050919050565b600082825260208201905092915050565b60005b8381101561042c578082015181840152602081019050610411565b8381111561043b576000848401525b50505050565b600061044c826103f2565b61045681856103fd565b935061046681856020860161040e565b61046f81610211565b840191505092915050565b600060208201905081810360008301526104948184610441565b905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b600060028204905060018216806104e357607f821691505b6020821081036104f6576104f561049c565b5b5091905056fea264697066735822122023ad8d54806a245232f78b540a8efdd8d8ab615e9009977a8423988971183d6e64736f6c634300080f0033"

# 创建合约对象
contract = w3.eth.contract(abi=abi, bytecode=bytecode)

# 创建合约的交易对象
construct_txn = contract.constructor().buildTransaction({
    'from': account.address,
    'nonce': w3.eth.getTransactionCount(account.address),
    'gas': 5000000,
    'gasPrice': w3.toWei('21', 'gwei')
    }
)

# 签名交易
signed = account.signTransaction(construct_txn)

# 获取交易信息
tx_id = w3.eth.sendRawTransaction(signed.rawTransaction)
receipt = w3.eth.waitForTransactionReceipt(tx_id)
address = receipt.contractAddress
print(address)
